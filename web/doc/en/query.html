





<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>1   Queries &mdash; ting 1 documentation</title>
    

    <style>
        .highlight {
            background: #272822 !important;
        }
    </style>

    
    

    
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://static.ccmbg.com/fc/css.php?m=footer">

    
    
    

    

    
    
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <link rel="top" title="ting 1 documentation" href="index.html"/>
    <link rel="next" title="2   Repository" href="repository.html"/>
    <link rel="prev" title="Ting - Documentation" href="index.html"/> 

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-nav-search">
            
            <a href="/" class="fa fa-home"> ting</a>
            
            
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
            <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">1&nbsp;&nbsp;&nbsp;Queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#effectuer-une-requete-de-lecture">1.1&nbsp;&nbsp;&nbsp;Perform a read query</a></li>
<li class="toctree-l2"><a class="reference internal" href="#effectuer-une-requete-d-ecriture">1.2&nbsp;&nbsp;&nbsp;Perform a write query</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="repository.html">2&nbsp;&nbsp;&nbsp;Repository</a><ul>
<li class="toctree-l2"><a class="reference internal" href="repository.html#au-sujet-du-repository">2.1&nbsp;&nbsp;&nbsp;About the repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="repository.html#creation-des-metadata">2.2&nbsp;&nbsp;&nbsp;Creating Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="repository.html#requetes">2.3&nbsp;&nbsp;&nbsp;Queries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hydrator.html">3&nbsp;&nbsp;&nbsp;About the hydrators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hydrator.html#au-sujet-des-hydrateurs">3.1&nbsp;&nbsp;&nbsp;About hydrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrator.html#l-hydrateur-par-defaut">3.2&nbsp;&nbsp;&nbsp;Default hydrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrator.html#donnees-sans-metadata">3.3&nbsp;&nbsp;&nbsp;Data without metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrator.html#mapper-des-donnees-sans-metadata">3.4&nbsp;&nbsp;&nbsp;Mapping data without metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrator.html#deserializer-des-donnees-sans-metadata">3.5&nbsp;&nbsp;&nbsp;Deserialize data without metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrator.html#composition-d-objet">3.6&nbsp;&nbsp;&nbsp;Object composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrator.html#l-hydrateur-pour-un-seul-objet">3.7&nbsp;&nbsp;&nbsp;The hydrator for a single object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="unitofwork.html">4&nbsp;&nbsp;&nbsp;UnitOfWork</a><ul>
<li class="toctree-l2"><a class="reference internal" href="unitofwork.html#au-sujet-de-l-unitofwork">4.1&nbsp;&nbsp;&nbsp;About the unitofwork</a></li>
<li class="toctree-l2"><a class="reference internal" href="unitofwork.html#principe">4.2&nbsp;&nbsp;&nbsp;Principle</a></li>
<li class="toctree-l2"><a class="reference internal" href="unitofwork.html#remarques-pour-les-batchs">4.3&nbsp;&nbsp;&nbsp;Notes for batch process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cache.html">5&nbsp;&nbsp;&nbsp;Cache</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cache.html#au-sujet-du-cache">5.1&nbsp;&nbsp;&nbsp;About the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html#requete-simple">5.2&nbsp;&nbsp;&nbsp;Simple query</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html#requete-preparee">5.3&nbsp;&nbsp;&nbsp;Prepared query</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="composant-cache.html">6&nbsp;&nbsp;&nbsp;The cache component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="composant-cache.html#configuration">6.1&nbsp;&nbsp;&nbsp;Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="composant-cache.html#sauvegarder-dans-le-cache">6.2&nbsp;&nbsp;&nbsp;Save into cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="composant-cache.html#sauvegarder-dans-le-cache-plusieurs-valeurs">6.3&nbsp;&nbsp;&nbsp;Save several values into the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="composant-cache.html#effacer-une-valeur-du-cache">6.4&nbsp;&nbsp;&nbsp;Delete a value from the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="composant-cache.html#effacer-plusieurs-valeurs-du-cache">6.5&nbsp;&nbsp;&nbsp;Delete several values from the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="composant-cache.html#remplacer-une-valeur-dans-le-cache">6.6&nbsp;&nbsp;&nbsp;Update a value in the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="composant-cache.html#sauvegarder-de-maniere-infinie">6.7&nbsp;&nbsp;&nbsp;Save with infinite time to live</a></li>
</ul>
</li>
</ul>

            
            
        </div>
        &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

        
        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
            <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
            <a href="index.html">ting</a>
        </nav>


        
        <div class="wy-nav-content">
            
            <div class="rst-content">
                





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>1&nbsp;&nbsp;&nbsp;Queries</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
                <div role="main" class="document">
                    
  <div class="section" id="les-requetes">
<h1>1&nbsp;&nbsp;&nbsp;Queries<a class="headerlink" href="#les-requetes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="effectuer-une-requete-de-lecture">
<h2>1.1&nbsp;&nbsp;&nbsp;Perform a read query<a class="headerlink" href="#effectuer-une-requete-de-lecture" title="Permalink to this headline">¶</a></h2>
<div class="section" id="l-objet-query">
<h3>1.1.1&nbsp;&nbsp;&nbsp;The Query object<a class="headerlink" href="#l-objet-query" title="Permalink to this headline">¶</a></h3>
<p>A query is done by retrieving the object CCMBenchmark\Ting\Query\Query from the <a class="reference internal" href="repository.html"><em>Repository</em></a>.</p>
<p>To do this, just call:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">(</span><span class="s1">&#39;SELECT ...&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="les-parametres">
<h3>1.1.2&nbsp;&nbsp;&nbsp;Parameters<a class="headerlink" href="#les-parametres" title="Permalink to this headline">¶</a></h3>
<p>To define dynamic parameters in the query call the method &#8220;setParams&#8221; which takes as argument an associative array:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">(</span><span class="s1">&#39;SELECT id, name FROM user WHERE name = :name&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParams</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sylvain&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="executer-la-requete">
<h3>1.1.3&nbsp;&nbsp;&nbsp;Perform the query<a class="headerlink" href="#executer-la-requete" title="Permalink to this headline">¶</a></h3>
<p>To fetch the data use the method &#8220;query&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">(</span><span class="s1">&#39;SELECT id, name FROM user WHERE name = :name&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParams</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sylvain&#39;</span><span class="p">]);</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="recuperer-les-resultats">
<h3>1.1.4&nbsp;&nbsp;&nbsp;Get the output<a class="headerlink" href="#recuperer-les-resultats" title="Permalink to this headline">¶</a></h3>
<p>The &#8220;query&#8221; method returns an object CCMBenchmark\Ting\Repository\Collection. This object is an Iterator, you can retrieve the results with an iteration:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">(</span><span class="s1">&#39;SELECT id, name FROM user WHERE name = :name&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParams</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sylvain&#39;</span><span class="p">]);</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$collection</span> <span class="k">as</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="explication-sur-le-format-retourne">
<h3>1.1.5&nbsp;&nbsp;&nbsp;Details about the output format<a class="headerlink" href="#explication-sur-le-format-retourne" title="Permalink to this headline">¶</a></h3>
<p>See the documentation about the <a class="reference internal" href="hydrator.html"><em>hydrators</em></a></p>
</div>
<div class="section" id="format-de-retour-simplifie-pour-des-requetes-sans-jointures">
<h3>1.1.6&nbsp;&nbsp;&nbsp;Simplified output format for queries without joins<a class="headerlink" href="#format-de-retour-simplifie-pour-des-requetes-sans-jointures" title="Permalink to this headline">¶</a></h3>
<p>See the documentation about the <a class="reference internal" href="hydrator.html#l-hydrateur-pour-un-seul-objet"><span>hydrator for a single object</span></a></p>
</div>
<div class="section" id="compter-les-elements-d-une-collection">
<h3>1.1.7&nbsp;&nbsp;&nbsp;Counting items in a collection<a class="headerlink" href="#compter-les-elements-d-une-collection" title="Permalink to this headline">¶</a></h3>
<p>Knowing that a Collection implements the standard interface Countable. Yu can find how many elements it contains just as you would do for a PHP array: count($collection);</p>
</div>
<div class="section" id="executer-une-requete-sur-le-master">
<h3>1.1.8&nbsp;&nbsp;&nbsp;Perform a query on the master<a class="headerlink" href="#executer-une-requete-sur-le-master" title="Permalink to this headline">¶</a></h3>
<p>A read query will be made by default on one of the configured slaves (when some slaves have been configured), if you need to perform your query on the master, then you must call the method &#8220;selectMaster&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">(</span><span class="s1">&#39;SELECT ...&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">selectMaster</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="erreur-sur-une-requete">
<h3>1.1.9&nbsp;&nbsp;&nbsp;Error on a query<a class="headerlink" href="#erreur-sur-une-requete" title="Permalink to this headline">¶</a></h3>
<p>If the query executed does not complete successfully, an exception of type CCMBenchmark\Ting\Driver\QueryException will be raised</p>
</div>
</div>
<div class="section" id="effectuer-une-requete-d-ecriture">
<h2>1.2&nbsp;&nbsp;&nbsp;Perform a write query<a class="headerlink" href="#effectuer-une-requete-d-ecriture" title="Permalink to this headline">¶</a></h2>
<p>The logic is the same as for a read request. Except that you need to call the method &#8220;execute&#8221; on the object CCMBenchmark\Ting\Query\Query</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">(</span><span class="s1">&#39;INSERT INTO ...&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>


                </div>
            </div>
        </div>

    </section>
    
<footer role="contentinfo" class="ccmcss_footer ccmcss_footer--dark">
    <ul class="toollinks">
        <li><a href="http://www.ccmbenchmark.com/advertising/fr/qui-sommes-nous/">Qui sommes-nous ?</a></li>
        <li><a href="http://www.ccmbenchmark.com/institut/contact/information">Contact</a></li>
        <li><a href="http://benchmail.benchmark.fr/magazine/archive_406_1.html">Press</a></li>
        <li><a href="http://www.journaldunet.com/donneesperso.shtml">Données personnelles</a></li>
        <li><a href="http://www.ccmbenchmark.com/mentions-legales">Mentions légales</a></li>
        <li><a href="http://www.ccmbenchmark.com/">&copy; 2015 CCM Benchmark</a></li>
    </ul>
    <div class="logo">
        <a href="#">
            <hgroup>
                <span>CCM Benchmark Group</span>
            </hgroup>
        </a>
    </div>
    <div class="brands">
        <a href="http://www.commentcamarche.net/" class="group_ccm" original-title="commentçamarche.net"></a>
        <a href="http://www.journaldunet.com/" class="group_jdn" original-title="Le Journal du Net"></a>
        <a href="http://droit-finances.commentcamarche.net/" class="group_df" original-title="Droit-finances.net"></a>
        <a href="http://www.journaldesfemmes.com/" class="group_jdf" original-title="Journal des femmes"></a>
        <a href="http://www.linternaute.com/" class="group_linter" original-title="linternaute.com"></a>
        <a href="http://copainsdavant.linternaute.com/" class="group_copains" original-title="Copains d'avant"></a>
        <a href="http://sante-medecine.commentcamarche.net/" class="group_ms" original-title="Santé-médecine.net"></a>
    </div>
    <p class="foot_links">
        <a href="http://www.linternaute.com/voyage/">Voyage</a>,
        <a href="http://www.linternaute.com/loisirs/">Loisirs</a>,
        <a href="http://www.linternaute.com/restaurant/">Restos</a>,
        <a href="http://www.linternaute.com/cinema/">Cinéma</a>,
        <a href="http://www.linternaute.com/bricolage/">Bricolage</a>,
        <a href="http://www.linternaute.com/argent/">Argent</a>,
        <a href="http://deco.journaldesfemmes.com/">Décoration</a>,
        <a href="http://cuisine.journaldesfemmes.com/">Cuisine</a>,
        <a href="http://www.linternaute.com/auto/">Auto</a>,
        <a href="http://sante.journaldesfemmes.com/">Santé</a>,
        <a href="http://www.linternaute.com/homme/">Homme</a>,
        <a href="http://www.linternaute.com/actualite/">Actualités</a>,
        <a href="http://www.commentcamarche.net/">High-tech</a>,
        <a href="http://www.journaldunet.com/">Entreprise</a>,
        <a href="http://expeert.com/fr/">Expeert</a>
    </p>
</footer>

</div>



<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Ting docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Versions</dt>
            
            <dd><a href="/ting/doc/en/index.html">en</a></dd>
            
            <dd><a href="/ting/doc/fr/index.html">fr</a></dd>
            
        </dl>
    </div>
</div>




<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'1',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
    };
</script>
<script type="text/javascript" src="_static/jquery.js"></script>
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>





<script type="text/javascript" src="_static/js/theme.js"></script>




<script type="text/javascript">
    jQuery(function () {
        SphinxRtdTheme.StickyNav.enable();
    });
</script>
 

</body>
</html>